(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[333],{5911:function(e,r,t){Promise.resolve().then(t.bind(t,7289))},7289:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return x}});var s=t(7437),a=t(2265),d=t(1865),o=t(8110),n=t(2160),i=t(8038),l=t(3588),c=t(5925),m=t(7269),u=t(8222);let p=n.Ry({email:n.Z_().email("Invalid email address").optional(),full_name:n.Z_().optional()}),h=n.Ry({old_password:n.Z_().min(1,"Current password is required"),new_password:n.Z_().min(8,"New password must be at least 8 characters"),confirm_password:n.Z_().min(1,"Please confirm your new password")}).refine(e=>e.new_password===e.confirm_password,{message:"Passwords don't match",path:["confirm_password"]});function x(){let{user:e,refetch:r}=(0,m.a)();(0,i.NL)();let[t,n]=(0,a.useState)("profile"),{register:x,handleSubmit:g,formState:{errors:y}}=(0,d.cI)({resolver:(0,o.F)(p),defaultValues:{email:(null==e?void 0:e.email)||"",full_name:(null==e?void 0:e.full_name)||""}}),{register:f,handleSubmit:b,formState:{errors:w},reset:k}=(0,d.cI)({resolver:(0,o.F)(h)}),v=(0,l.D)({mutationFn:e=>u.x.updateProfile(e),onSuccess:()=>{c.ZP.success("Profile updated successfully!"),r()},onError:e=>{var r,t;c.ZP.error((null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.detail)||"Failed to update profile")}}),j=(0,l.D)({mutationFn:e=>u.x.changePassword(e.old_password,e.new_password),onSuccess:()=>{c.ZP.success("Password changed successfully!"),k()},onError:e=>{var r,t;c.ZP.error((null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.detail)||"Failed to change password")}}),N=async e=>{await v.mutateAsync(e)},_=async e=>{await j.mutateAsync({old_password:e.old_password,new_password:e.new_password})};return e?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8",children:(0,s.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg",children:[(0,s.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,s.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900 dark:text-white",children:"User Profile"}),(0,s.jsx)("p",{className:"mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400",children:"Manage your account settings and preferences."})]}),(0,s.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("nav",{className:"-mb-px flex space-x-8 px-4 sm:px-6",children:[(0,s.jsx)("button",{onClick:()=>n("profile"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("profile"===t?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:"Profile Information"}),(0,s.jsx)("button",{onClick:()=>n("password"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("password"===t?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:"Change Password"})]})}),(0,s.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:["profile"===t&&(0,s.jsxs)("form",{onSubmit:g(N),className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Username"}),(0,s.jsx)("input",{type:"text",value:e.username,disabled:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-500 dark:text-gray-400 rounded-md sm:text-sm"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Username cannot be changed"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Email"}),(0,s.jsx)("input",{...x("email"),type:"email",className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 placeholder-gray-500 dark:placeholder-gray-400 text-gray-900 dark:text-white rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm bg-white dark:bg-gray-800"}),y.email&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:y.email.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"full_name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Full Name"}),(0,s.jsx)("input",{...x("full_name"),type:"text",className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 placeholder-gray-500 dark:placeholder-gray-400 text-gray-900 dark:text-white rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm bg-white dark:bg-gray-800"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Role"}),(0,s.jsx)("input",{type:"text",value:e.role,disabled:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-500 dark:text-gray-400 rounded-md sm:text-sm"})]}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)("button",{type:"submit",disabled:v.isLoading,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50",children:v.isLoading?"Saving...":"Save Changes"})})]}),"password"===t&&(0,s.jsxs)("form",{onSubmit:b(_),className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"old_password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Current Password"}),(0,s.jsx)("input",{...f("old_password"),type:"password",required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 placeholder-gray-500 dark:placeholder-gray-400 text-gray-900 dark:text-white rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm bg-white dark:bg-gray-800"}),w.old_password&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:w.old_password.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"new_password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"New Password"}),(0,s.jsx)("input",{...f("new_password"),type:"password",required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 placeholder-gray-500 dark:placeholder-gray-400 text-gray-900 dark:text-white rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm bg-white dark:bg-gray-800"}),w.new_password&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:w.new_password.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"confirm_password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Confirm New Password"}),(0,s.jsx)("input",{...f("confirm_password"),type:"password",required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 placeholder-gray-500 dark:placeholder-gray-400 text-gray-900 dark:text-white rounded-md focus:outline-none focus:ring-primary focus:border-primary sm:text-sm bg-white dark:bg-gray-800"}),w.confirm_password&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:w.confirm_password.message})]}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)("button",{type:"submit",disabled:j.isLoading,className:"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50",children:j.isLoading?"Changing...":"Change Password"})})]})]})]})})}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})})}},7269:function(e,r,t){"use strict";t.d(r,{a:function(){return d}});var s=t(9891),a=t(8222);function d(){let{data:e,isLoading:r,error:t,refetch:d}=(0,s.a)({queryKey:["currentUser"],queryFn:()=>a.x.getCurrentUser(),retry:!1,staleTime:3e5}),o=(null==e?void 0:e.role)==="admin",n=(null==e?void 0:e.role)==="researcher"||o;return{user:e,isLoading:r,isAuthenticated:!!e&&!t,isAdmin:o,isResearcher:n,error:t,refetch:d}}},8222:function(e,r,t){"use strict";t.d(r,{x:function(){return o}});var s=t(4829);let a=t(2601).env.NEXT_PUBLIC_API_URL||"http://localhost:8000";class d{generateKey(e){let{method:r,url:t,params:s,data:a}=e;return"".concat((null==r?void 0:r.toUpperCase())||"GET",":").concat(t,":").concat(JSON.stringify(s||{}),":").concat(JSON.stringify(a||{}))}isExpired(e){return Date.now()-e.timestamp>this.ttl}getCachedResponse(e){let r=this.cache.get(e);return r?this.isExpired(r)?(this.cache.delete(e),null):r:null}setCachedResponse(e,r,t){this.cache.set(e,{response:r,timestamp:Date.now(),promise:t})}clearExpired(){for(let[e,r]of this.cache.entries())this.isExpired(r)&&this.cache.delete(e)}async deduplicatedRequest(e){let r=this.generateKey(e),t=this.getCachedResponse(r);if(t)return t.promise?(this.stats.concurrent++,t.promise):(this.stats.hits++,t.response);this.stats.misses++;let s=this.client.request(e).then(e=>(this.setCachedResponse(r,e.data),e.data)).catch(e=>{throw this.cache.delete(r),e});return this.setCachedResponse(r,null,s),s}getDeduplicationStats(){return{...this.stats}}clearCache(){this.cache.clear()}async register(e){return this.deduplicatedRequest({method:"post",url:"/auth/register",data:e})}async login(e){return this.deduplicatedRequest({method:"post",url:"/auth/login",data:e})}async getCurrentUser(){return this.deduplicatedRequest({method:"get",url:"/auth/me"})}async updateProfile(e){return this.deduplicatedRequest({method:"put",url:"/auth/me",data:e})}async changePassword(e,r){return this.deduplicatedRequest({method:"post",url:"/auth/change-password",data:{old_password:e,new_password:r}})}async forgotPassword(e){return this.deduplicatedRequest({method:"post",url:"/auth/forgot-password",data:e})}async resetPassword(e){return this.deduplicatedRequest({method:"post",url:"/auth/reset-password",data:e})}async research(e){return this.deduplicatedRequest({method:"get",url:"/research",params:{query:e}})}async getUsers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return this.deduplicatedRequest({method:"get",url:"/admin/users",params:{skip:e,limit:r}})}async updateUserRole(e,r){return this.deduplicatedRequest({method:"put",url:"/admin/users/".concat(e,"/role"),data:{new_role:r}})}async healthCheck(){return this.deduplicatedRequest({method:"get",url:"/"})}constructor(e=3e5){this.client=s.Z.create({baseURL:a,headers:{"Content-Type":"application/json"}}),this.cache=new Map,this.ttl=e,this.stats={hits:0,misses:0,concurrent:0},this.client.interceptors.request.use(e=>{let r=localStorage.getItem("access_token");return r&&(e.headers.Authorization="Bearer ".concat(r)),e},e=>Promise.reject(e)),this.client.interceptors.response.use(e=>e,e=>{var r;return(null===(r=e.response)||void 0===r?void 0:r.status)===401&&(localStorage.removeItem("access_token"),window.location.href="/auth/login"),Promise.reject(e)})}}let o=new d}},function(e){e.O(0,[517,829,891,797,971,938,744],function(){return e(e.s=5911)}),_N_E=e.O()}]);