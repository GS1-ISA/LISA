(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[50],{2767:function(e,s,t){Promise.resolve().then(t.bind(t,7271))},7271:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return l}});var r=t(7437),a=t(2265),n=t(4337),i=t(1117);function l(){let[e,s]=(0,a.useState)(null),[t,l]=(0,a.useState)([]),[c,o]=(0,a.useState)(""),[d,u]=(0,a.useState)(!1),[h,m]=(0,a.useState)(!1),x=(0,a.useRef)(null),g=()=>{var e;null===(e=x.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,a.useEffect)(()=>{g()},[t]),(0,a.useEffect)(()=>{let e=(0,n.io)("http://localhost:8000",{transports:["websocket","polling"],auth:{user_id:1,username:"demo_user",role:"user"}});return e.on("connect",()=>{console.log("Connected to chat server"),u(!0)}),e.on("disconnect",()=>{console.log("Disconnected from chat server"),u(!1)}),e.on("connected",e=>{console.log("Chat server response:",e.message),l([{id:"welcome",message:"Hello! I'm your Compliance Assistant. I can help you with EUDR compliance questions, regulatory analysis, and compliance guidance. What would you like to know?",sender:"assistant",timestamp:Date.now()}])}),e.on("chat_response",e=>{let s={id:"assistant_".concat(Date.now()),message:e.message,sender:"assistant",timestamp:e.timestamp,session_id:e.session_id};l(e=>[...e,s]),m(!1)}),e.on("typing",e=>{"thinking"===e.status?m(!0):m(!1)}),e.on("error",e=>{console.error("Chat error:",e.message),m(!1)}),s(e),()=>{e.disconnect()}},[]);let f=()=>{if(!e||!c.trim())return;let s={id:"user_".concat(Date.now()),message:c,sender:"user",timestamp:Date.now()};l(e=>[...e,s]),e.emit("chat_message",{message:c}),o("")};return(0,r.jsx)(i.Z,{children:(0,r.jsxs)("div",{className:"flex flex-col h-screen bg-gray-50 dark:bg-gray-900",children:[(0,r.jsx)("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Compliance Assistant"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"AI-powered EUDR compliance guidance"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(d?"bg-green-500":"bg-red-500")}),(0,r.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:d?"Connected":"Disconnected"})]})]})}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto space-y-4",children:[t.map(e=>(0,r.jsx)("div",{className:"flex ".concat("user"===e.sender?"justify-end":"justify-start"),children:(0,r.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat("user"===e.sender?"bg-blue-600 text-white":"bg-white dark:bg-gray-800 text-gray-900 dark:text-white border border-gray-200 dark:border-gray-700"),children:[(0,r.jsx)("p",{className:"text-sm",children:e.message}),(0,r.jsx)("p",{className:"text-xs mt-1 opacity-70",children:new Date(e.timestamp).toLocaleTimeString()})]})},e.id)),h&&(0,r.jsx)("div",{className:"flex justify-start",children:(0,r.jsx)("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 px-4 py-2 rounded-lg",children:(0,r.jsxs)("div",{className:"flex space-x-1",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,r.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,r.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})}),(0,r.jsx)("div",{ref:x})]})}),(0,r.jsx)("div",{className:"bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 px-4 py-4",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex space-x-4",children:[(0,r.jsx)("textarea",{value:c,onChange:e=>o(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),f())},placeholder:"Ask me about EUDR compliance, regulatory requirements, or compliance guidance...",className:"flex-1 resize-none rounded-lg border border-gray-300 dark:border-gray-600 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",rows:1,disabled:!d||h}),(0,r.jsx)("button",{onClick:f,disabled:!d||!c.trim()||h,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Send"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"Press Enter to send, Shift+Enter for new line"})]})})]})})}},1117:function(e,s,t){"use strict";t.d(s,{Z:function(){return w}});var r=t(7437),a=t(2265),n=t(1396),i=t.n(n),l=t(4033),c=t(6435),o=t(7269),d=t(4992),u=t(6610),h=t(654),m=t(9010),x=t(9649),g=t(6689),f=t(9874),p=t(7323),y=t(4271),b=t(1809),v=t(5518);let j=[{name:"Dashboard",href:"/",icon:d.Z,roles:["user","researcher","admin"]},{name:"Research",href:"/research",icon:u.Z,roles:["researcher","admin"]},{name:"Compliance",href:"/compliance",icon:h.Z,roles:["user","researcher","admin"]},{name:"Agents",href:"/agents",icon:m.Z,roles:["admin"]},{name:"Admin",href:"/admin",icon:x.Z,roles:["admin"]}];function w(e){let{children:s}=e,[t,n]=(0,a.useState)(!1),{user:d,isAuthenticated:u}=(0,o.a)(),{theme:h,setTheme:m}=(0,c.F)(),x=(0,l.useRouter)(),w=j.filter(e=>(null==d?void 0:d.role)&&e.roles.includes(d.role));return u?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,r.jsxs)("div",{className:"fixed inset-0 z-50 lg:hidden ".concat(t?"block":"hidden"),children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:()=>n(!1)}),(0,r.jsxs)("div",{className:"fixed inset-y-0 left-0 flex w-full max-w-xs flex-col bg-white dark:bg-gray-800",children:[(0,r.jsxs)("div",{className:"flex h-16 flex-shrink-0 items-center justify-between px-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ISA Platform"}),(0,r.jsx)("button",{onClick:()=>n(!1),className:"text-gray-400 hover:text-gray-500",children:(0,r.jsx)(g.Z,{className:"h-6 w-6"})})]}),(0,r.jsx)("nav",{className:"flex-1 space-y-1 px-2 py-4",children:w.map(e=>(0,r.jsxs)(i(),{href:e.href,className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white",onClick:()=>n(!1),children:[(0,r.jsx)(e.icon,{className:"mr-3 h-5 w-5"}),e.name]},e.name))})]})]}),(0,r.jsx)("div",{className:"hidden lg:fixed lg:inset-y-0 lg:flex lg:w-64 lg:flex-col",children:(0,r.jsxs)("div",{className:"flex flex-col flex-grow bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("div",{className:"flex items-center h-16 flex-shrink-0 px-4",children:(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"ISA Platform"})}),(0,r.jsx)("nav",{className:"flex-1 flex flex-col divide-y divide-gray-200 dark:divide-gray-700 overflow-y-auto",children:(0,r.jsx)("div",{className:"px-2 py-4 space-y-1",children:w.map(e=>(0,r.jsxs)(i(),{href:e.href,className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-white",children:[(0,r.jsx)(e.icon,{className:"mr-3 h-5 w-5"}),e.name]},e.name))})})]})}),(0,r.jsxs)("div",{className:"lg:pl-64",children:[(0,r.jsxs)("div",{className:"sticky top-0 z-10 flex h-16 flex-shrink-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("button",{onClick:()=>n(!0),className:"px-4 border-r border-gray-200 dark:border-gray-700 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary lg:hidden",children:(0,r.jsx)(f.Z,{className:"h-6 w-6"})}),(0,r.jsxs)("div",{className:"flex flex-1 justify-between px-4",children:[(0,r.jsx)("div",{className:"flex flex-1",children:(0,r.jsxs)("div",{className:"flex w-full md:ml-0",children:[(0,r.jsx)("label",{htmlFor:"search-field",className:"sr-only",children:"Search"}),(0,r.jsx)("div",{className:"relative w-full text-gray-400 focus-within:text-gray-600",children:(0,r.jsx)("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center"})})]})}),(0,r.jsxs)("div",{className:"ml-4 flex items-center md:ml-6",children:[(0,r.jsx)("button",{onClick:()=>m("dark"===h?"light":"dark"),className:"p-1 rounded-full text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:"dark"===h?(0,r.jsx)(p.Z,{className:"h-6 w-6"}):(0,r.jsx)(y.Z,{className:"h-6 w-6"})}),(0,r.jsx)("div",{className:"ml-3 relative",children:(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:null==d?void 0:d.username}),(0,r.jsx)(i(),{href:"/auth/profile",className:"p-1 rounded-full text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:(0,r.jsx)(b.Z,{className:"h-6 w-6"})}),(0,r.jsx)("button",{onClick:()=>{localStorage.removeItem("access_token"),x.push("/auth/login")},className:"p-1 rounded-full text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:(0,r.jsx)(v.Z,{className:"h-6 w-6"})})]})})]})]})]}),(0,r.jsx)("main",{className:"flex-1",children:s})]})]}):(0,r.jsx)(r.Fragment,{children:s})}},7269:function(e,s,t){"use strict";t.d(s,{a:function(){return n}});var r=t(9891),a=t(8222);function n(){let{data:e,isLoading:s,error:t,refetch:n}=(0,r.a)({queryKey:["currentUser"],queryFn:()=>a.x.getCurrentUser(),retry:!1,staleTime:3e5}),i=(null==e?void 0:e.role)==="admin",l=(null==e?void 0:e.role)==="researcher"||i;return{user:e,isLoading:s,isAuthenticated:!!e&&!t,isAdmin:i,isResearcher:l,error:t,refetch:n}}},8222:function(e,s,t){"use strict";t.d(s,{x:function(){return i}});var r=t(4829);let a=t(2601).env.NEXT_PUBLIC_API_URL||"http://localhost:8000";class n{generateKey(e){let{method:s,url:t,params:r,data:a}=e;return"".concat((null==s?void 0:s.toUpperCase())||"GET",":").concat(t,":").concat(JSON.stringify(r||{}),":").concat(JSON.stringify(a||{}))}isExpired(e){return Date.now()-e.timestamp>this.ttl}getCachedResponse(e){let s=this.cache.get(e);return s?this.isExpired(s)?(this.cache.delete(e),null):s:null}setCachedResponse(e,s,t){this.cache.set(e,{response:s,timestamp:Date.now(),promise:t})}clearExpired(){for(let[e,s]of this.cache.entries())this.isExpired(s)&&this.cache.delete(e)}async deduplicatedRequest(e){let s=this.generateKey(e),t=this.getCachedResponse(s);if(t)return t.promise?(this.stats.concurrent++,t.promise):(this.stats.hits++,t.response);this.stats.misses++;let r=this.client.request(e).then(e=>(this.setCachedResponse(s,e.data),e.data)).catch(e=>{throw this.cache.delete(s),e});return this.setCachedResponse(s,null,r),r}getDeduplicationStats(){return{...this.stats}}clearCache(){this.cache.clear()}async register(e){return this.deduplicatedRequest({method:"post",url:"/auth/register",data:e})}async login(e){return this.deduplicatedRequest({method:"post",url:"/auth/login",data:e})}async getCurrentUser(){return this.deduplicatedRequest({method:"get",url:"/auth/me"})}async updateProfile(e){return this.deduplicatedRequest({method:"put",url:"/auth/me",data:e})}async changePassword(e,s){return this.deduplicatedRequest({method:"post",url:"/auth/change-password",data:{old_password:e,new_password:s}})}async forgotPassword(e){return this.deduplicatedRequest({method:"post",url:"/auth/forgot-password",data:e})}async resetPassword(e){return this.deduplicatedRequest({method:"post",url:"/auth/reset-password",data:e})}async research(e){return this.deduplicatedRequest({method:"get",url:"/research",params:{query:e}})}async getUsers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return this.deduplicatedRequest({method:"get",url:"/admin/users",params:{skip:e,limit:s}})}async updateUserRole(e,s){return this.deduplicatedRequest({method:"put",url:"/admin/users/".concat(e,"/role"),data:{new_role:s}})}async healthCheck(){return this.deduplicatedRequest({method:"get",url:"/"})}constructor(e=3e5){this.client=r.Z.create({baseURL:a,headers:{"Content-Type":"application/json"}}),this.cache=new Map,this.ttl=e,this.stats={hits:0,misses:0,concurrent:0},this.client.interceptors.request.use(e=>{let s=localStorage.getItem("access_token");return s&&(e.headers.Authorization="Bearer ".concat(s)),e},e=>Promise.reject(e)),this.client.interceptors.response.use(e=>e,e=>{var s;return(null===(s=e.response)||void 0===s?void 0:s.status)===401&&(localStorage.removeItem("access_token"),window.location.href="/auth/login"),Promise.reject(e)})}}let i=new n}},function(e){e.O(0,[517,829,251,891,314,971,938,744],function(){return e(e.s=2767)}),_N_E=e.O()}]);